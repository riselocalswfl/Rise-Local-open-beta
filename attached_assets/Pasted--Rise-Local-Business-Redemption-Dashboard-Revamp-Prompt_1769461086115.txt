# Rise Local: Business Redemption Dashboard Revamp Prompt

## Current Problem

The Redemptions page shows "Unable to load redemption history" error. We need to fix this AND transform it into a powerful, industry-standard redemption tracking system that helps businesses monitor their deal performance in real-time.

---

## REPLIT AGENT: Revamp Business Redemption Dashboard

### Mission
Create a professional, real-time redemption tracking dashboard for vendor businesses with notifications, analytics, and industry-standard features similar to Groupon Merchant, Toast POS, and Square for Restaurants.

---

## Part 1: Fix the Current Error

**First, diagnose why redemption history won't load:**

1. Check if there's a `/api/business/redemptions` or similar endpoint
2. Check browser console for error messages
3. Check if the API endpoint exists and what it returns
4. Verify database has redemption data
5. Fix any authentication or data loading issues

**If endpoint doesn't exist, create it:**
```typescript
GET /api/business/redemptions
- Returns all redemptions for the logged-in vendor's deals
- Includes: customer name, deal name, redemption date/time, deal value
- Sorted by most recent first
- Paginated (20 per page)
```

---

## Part 2: Database Schema for Redemptions

**Make sure these tables exist with proper structure:**

```sql
-- Redemptions table (if doesn't exist)
CREATE TABLE IF NOT EXISTS redemptions (
  id SERIAL PRIMARY KEY,
  dealId INTEGER NOT NULL REFERENCES deals(id) ON DELETE CASCADE,
  userId INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  vendorId INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  redemptionCode VARCHAR(50) UNIQUE,
  status VARCHAR(50) DEFAULT 'pending', -- 'pending', 'completed', 'cancelled', 'expired'
  redemptionMethod VARCHAR(50), -- 'in-store', 'online', 'scan'
  discountAmount DECIMAL(10, 2),
  originalPrice DECIMAL(10, 2),
  finalPrice DECIMAL(10, 2),
  redeemedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completedAt TIMESTAMP,
  cancelledAt TIMESTAMP,
  notes TEXT,
  customerRating INTEGER, -- 1-5 stars
  customerFeedback TEXT,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_redemptions_vendor ON redemptions(vendorId);
CREATE INDEX IF NOT EXISTS idx_redemptions_deal ON redemptions(dealId);
CREATE INDEX IF NOT EXISTS idx_redemptions_user ON redemptions(userId);
CREATE INDEX IF NOT EXISTS idx_redemptions_date ON redemptions(redeemedAt DESC);
CREATE INDEX IF NOT EXISTS idx_redemptions_status ON redemptions(status);

-- Notifications table
CREATE TABLE IF NOT EXISTS notifications (
  id SERIAL PRIMARY KEY,
  userId INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL, -- 'redemption', 'review', 'favorite', 'message'
  title VARCHAR(255) NOT NULL,
  message TEXT NOT NULL,
  relatedId INTEGER, -- redemption id, deal id, etc.
  relatedType VARCHAR(50), -- 'redemption', 'deal', 'user'
  isRead BOOLEAN DEFAULT false,
  actionUrl VARCHAR(255),
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_notifications_user ON notifications(userId);
CREATE INDEX IF NOT EXISTS idx_notifications_unread ON notifications(userId, isRead) WHERE isRead = false;
```

---

## Part 3: Real-Time Notifications System

### Backend: Notification Creation

**When a deal is redeemed, create a notification:**

```typescript
// server/utils/notifications.ts
export async function createRedemptionNotification(redemption: any) {
  await db.query(
    `INSERT INTO notifications (userId, type, title, message, relatedId, relatedType, actionUrl)
     VALUES ($1, $2, $3, $4, $5, $6, $7)`,
    [
      redemption.vendorId,
      'redemption',
      'üéâ New Deal Redeemed!',
      `${redemption.customerName} just redeemed "${redemption.dealTitle}"`,
      redemption.id,
      'redemption',
      `/business/redemptions/${redemption.id}`
    ]
  );
}

// Call this whenever a redemption happens
// In your redemption creation endpoint:
const redemption = await createRedemption(...);
await createRedemptionNotification(redemption);
```

### Backend: Notification Endpoints

```typescript
// GET /api/notifications
// Returns unread notifications for logged-in user
export async function getNotifications(req, res) {
  const notifications = await db.query(
    `SELECT * FROM notifications 
     WHERE userId = $1 
     ORDER BY createdAt DESC 
     LIMIT 50`,
    [req.user.id]
  );
  
  const unreadCount = await db.query(
    'SELECT COUNT(*) FROM notifications WHERE userId = $1 AND isRead = false',
    [req.user.id]
  );
  
  res.json({
    notifications: notifications.rows,
    unreadCount: parseInt(unreadCount.rows[0].count)
  });
}

// POST /api/notifications/:id/mark-read
export async function markNotificationRead(req, res) {
  await db.query(
    'UPDATE notifications SET isRead = true WHERE id = $1 AND userId = $2',
    [req.params.id, req.user.id]
  );
  res.json({ success: true });
}

// POST /api/notifications/mark-all-read
export async function markAllNotificationsRead(req, res) {
  await db.query(
    'UPDATE notifications SET isRead = true WHERE userId = $1',
    [req.user.id]
  );
  res.json({ success: true });
}
```

---

## Part 4: Complete Redemption Dashboard UI

### Design Features (Industry Standard)

**Header Stats Cards:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Today's Redemptions    üí∞ Today's Revenue    üìà This Week ‚îÇ
‚îÇ        12                      $487.50              67        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Filter Bar:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [All Deals ‚ñº]  [All Status ‚ñº]  [Last 7 Days ‚ñº]  [Search...] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Redemption List:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üé´ Summer Special - 50% Off                                 ‚îÇ
‚îÇ  üë§ Sarah Johnson                                            ‚îÇ
‚îÇ  üïê Today at 2:45 PM                                         ‚îÇ
‚îÇ  üíµ Saved: $15.00 | Revenue: $15.00                          ‚îÇ
‚îÇ  ‚úÖ Completed                                                ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  üé´ Buy 1 Get 1 Free                                         ‚îÇ
‚îÇ  üë§ Mike Chen                                                ‚îÇ
‚îÇ  üïê Today at 1:30 PM                                         ‚îÇ
‚îÇ  üíµ Saved: $12.00 | Revenue: $12.00                          ‚îÇ
‚îÇ  ‚úÖ Completed                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### React Component Structure

```typescript
// client/src/pages/business/Redemptions.tsx

import { useState, useEffect } from 'react';
import { useQuery } from '@tanstack/react-query';

interface Redemption {
  id: number;
  dealTitle: string;
  customerName: string;
  customerEmail: string;
  redeemedAt: string;
  status: 'pending' | 'completed' | 'cancelled' | 'expired';
  discountAmount: number;
  originalPrice: number;
  finalPrice: number;
  redemptionMethod: string;
  customerRating?: number;
  customerFeedback?: string;
}

interface Stats {
  todayCount: number;
  todayRevenue: number;
  weekCount: number;
  weekRevenue: number;
  monthCount: number;
  monthRevenue: number;
}

export default function RedemptionsDashboard() {
  const [filter, setFilter] = useState({
    dealId: 'all',
    status: 'all',
    dateRange: '7days'
  });

  // Fetch redemptions
  const { data: redemptions, isLoading } = useQuery({
    queryKey: ['redemptions', filter],
    queryFn: async () => {
      const params = new URLSearchParams({
        dealId: filter.dealId,
        status: filter.status,
        dateRange: filter.dateRange
      });
      const response = await fetch(`/api/business/redemptions?${params}`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });
      return response.json();
    }
  });

  // Fetch stats
  const { data: stats } = useQuery({
    queryKey: ['redemption-stats'],
    queryFn: async () => {
      const response = await fetch('/api/business/redemption-stats', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });
      return response.json();
    },
    refetchInterval: 30000 // Refresh every 30 seconds
  });

  return (
    <div className="redemptions-dashboard">
      {/* Header Stats */}
      <div className="stats-grid">
        <StatCard
          icon="üìä"
          label="Today's Redemptions"
          value={stats?.todayCount || 0}
          trend="+12% from yesterday"
        />
        <StatCard
          icon="üí∞"
          label="Today's Revenue"
          value={`$${(stats?.todayRevenue || 0).toFixed(2)}`}
          trend="+8% from yesterday"
        />
        <StatCard
          icon="üìà"
          label="This Week"
          value={stats?.weekCount || 0}
          trend={`$${(stats?.weekRevenue || 0).toFixed(2)} total`}
        />
        <StatCard
          icon="üìÖ"
          label="This Month"
          value={stats?.monthCount || 0}
          trend={`$${(stats?.monthRevenue || 0).toFixed(2)} total`}
        />
      </div>

      {/* Filters */}
      <div className="filter-bar">
        <select 
          value={filter.dealId}
          onChange={(e) => setFilter({ ...filter, dealId: e.target.value })}
        >
          <option value="all">All Deals</option>
          {/* Map through user's deals */}
        </select>

        <select
          value={filter.status}
          onChange={(e) => setFilter({ ...filter, status: e.target.value })}
        >
          <option value="all">All Status</option>
          <option value="completed">Completed</option>
          <option value="pending">Pending</option>
          <option value="cancelled">Cancelled</option>
        </select>

        <select
          value={filter.dateRange}
          onChange={(e) => setFilter({ ...filter, dateRange: e.target.value })}
        >
          <option value="today">Today</option>
          <option value="7days">Last 7 Days</option>
          <option value="30days">Last 30 Days</option>
          <option value="all">All Time</option>
        </select>

        <input
          type="search"
          placeholder="Search customer name..."
          className="search-input"
        />
      </div>

      {/* Redemption List */}
      <div className="redemption-list">
        {isLoading ? (
          <LoadingSpinner />
        ) : redemptions?.length === 0 ? (
          <EmptyState
            icon="üé´"
            title="No Redemptions Yet"
            description="Your redemption history will appear here once customers start using your deals."
          />
        ) : (
          redemptions?.map((redemption: Redemption) => (
            <RedemptionCard key={redemption.id} redemption={redemption} />
          ))
        )}
      </div>

      {/* Export Button */}
      <div className="export-section">
        <button onClick={() => exportRedemptions(filter)}>
          üì• Export to CSV
        </button>
      </div>
    </div>
  );
}

// Stat Card Component
function StatCard({ icon, label, value, trend }: any) {
  return (
    <div className="stat-card">
      <div className="stat-icon">{icon}</div>
      <div className="stat-content">
        <div className="stat-label">{label}</div>
        <div className="stat-value">{value}</div>
        <div className="stat-trend">{trend}</div>
      </div>
    </div>
  );
}

// Redemption Card Component
function RedemptionCard({ redemption }: { redemption: Redemption }) {
  const timeAgo = formatTimeAgo(redemption.redeemedAt);
  
  return (
    <div className="redemption-card">
      <div className="redemption-header">
        <h3>üé´ {redemption.dealTitle}</h3>
        <span className={`status-badge status-${redemption.status}`}>
          {redemption.status}
        </span>
      </div>

      <div className="redemption-details">
        <div className="detail-row">
          <span className="label">üë§ Customer:</span>
          <span className="value">{redemption.customerName}</span>
        </div>

        <div className="detail-row">
          <span className="label">üïê Time:</span>
          <span className="value">{timeAgo}</span>
        </div>

        <div className="detail-row">
          <span className="label">üíµ Savings:</span>
          <span className="value savings">${redemption.discountAmount.toFixed(2)}</span>
        </div>

        <div className="detail-row">
          <span className="label">üìä Revenue:</span>
          <span className="value revenue">${redemption.finalPrice.toFixed(2)}</span>
        </div>

        <div className="detail-row">
          <span className="label">üì± Method:</span>
          <span className="value">{redemption.redemptionMethod}</span>
        </div>

        {redemption.customerRating && (
          <div className="detail-row">
            <span className="label">‚≠ê Rating:</span>
            <span className="value">
              {'‚≠ê'.repeat(redemption.customerRating)}
            </span>
          </div>
        )}
      </div>

      {redemption.customerFeedback && (
        <div className="customer-feedback">
          <p>üí¨ "{redemption.customerFeedback}"</p>
        </div>
      )}
    </div>
  );
}

// Empty State Component
function EmptyState({ icon, title, description }: any) {
  return (
    <div className="empty-state">
      <div className="empty-icon">{icon}</div>
      <h3>{title}</h3>
      <p>{description}</p>
    </div>
  );
}

// Utility: Format time ago
function formatTimeAgo(date: string): string {
  const now = new Date();
  const redemptionDate = new Date(date);
  const diffMs = now.getTime() - redemptionDate.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);

  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
  if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
  return redemptionDate.toLocaleDateString();
}

// Export functionality
async function exportRedemptions(filter: any) {
  const params = new URLSearchParams(filter);
  const response = await fetch(`/api/business/redemptions/export?${params}`, {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
    }
  });
  
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `redemptions-${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
```

---

## Part 5: Real-Time Notification Bell

### Notification Bell Component

```typescript
// client/src/components/NotificationBell.tsx

import { useState, useEffect } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

export default function NotificationBell() {
  const [isOpen, setIsOpen] = useState(false);
  const queryClient = useQueryClient();

  // Fetch notifications
  const { data: notificationData } = useQuery({
    queryKey: ['notifications'],
    queryFn: async () => {
      const response = await fetch('/api/notifications', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });
      return response.json();
    },
    refetchInterval: 30000 // Check every 30 seconds
  });

  const notifications = notificationData?.notifications || [];
  const unreadCount = notificationData?.unreadCount || 0;

  // Mark as read mutation
  const markRead = useMutation({
    mutationFn: async (notificationId: number) => {
      await fetch(`/api/notifications/${notificationId}/mark-read`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['notifications'] });
    }
  });

  // Mark all as read
  const markAllRead = useMutation({
    mutationFn: async () => {
      await fetch('/api/notifications/mark-all-read', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
        }
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['notifications'] });
    }
  });

  return (
    <div className="notification-bell-container">
      <button 
        className="notification-bell"
        onClick={() => setIsOpen(!isOpen)}
      >
        üîî
        {unreadCount > 0 && (
          <span className="notification-badge">{unreadCount}</span>
        )}
      </button>

      {isOpen && (
        <div className="notification-dropdown">
          <div className="notification-header">
            <h3>Notifications</h3>
            {unreadCount > 0 && (
              <button 
                onClick={() => markAllRead.mutate()}
                className="mark-all-read"
              >
                Mark all as read
              </button>
            )}
          </div>

          <div className="notification-list">
            {notifications.length === 0 ? (
              <div className="empty-notifications">
                <p>No notifications yet</p>
              </div>
            ) : (
              notifications.map((notification: any) => (
                <div
                  key={notification.id}
                  className={`notification-item ${!notification.isRead ? 'unread' : ''}`}
                  onClick={() => {
                    markRead.mutate(notification.id);
                    if (notification.actionUrl) {
                      window.location.href = notification.actionUrl;
                    }
                  }}
                >
                  <div className="notification-content">
                    <strong>{notification.title}</strong>
                    <p>{notification.message}</p>
                    <span className="notification-time">
                      {formatTimeAgo(notification.createdAt)}
                    </span>
                  </div>
                  {!notification.isRead && (
                    <div className="unread-dot" />
                  )}
                </div>
              ))
            )}
          </div>

          <div className="notification-footer">
            <a href="/notifications">View all notifications</a>
          </div>
        </div>
      )}
    </div>
  );
}
```

**Add to Business Header:**
```typescript
// In your BusinessDashboard layout header
<header>
  <Logo />
  <nav>
    <Link to="/business/dashboard">Dashboard</Link>
    <Link to="/business/deals">Deals</Link>
    <Link to="/business/redemptions">Redemptions</Link>
  </nav>
  <NotificationBell /> {/* Add this */}
  <UserMenu />
</header>
```

---

## Part 6: Industry-Standard Features

### 1. Analytics Charts

**Add chart showing redemption trends:**

```typescript
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';

function RedemptionChart({ data }: any) {
  return (
    <div className="chart-container">
      <h3>üìä Redemption Trends</h3>
      <LineChart width={600} height={300} data={data}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis dataKey="date" />
        <YAxis />
        <Tooltip />
        <Legend />
        <Line type="monotone" dataKey="redemptions" stroke="#8884d8" />
        <Line type="monotone" dataKey="revenue" stroke="#82ca9d" />
      </LineChart>
    </div>
  );
}
```

### 2. Quick Actions

**Add quick action buttons:**
```typescript
<div className="quick-actions">
  <button onClick={() => navigate('/business/deals/create')}>
    ‚ûï Create New Deal
  </button>
  <button onClick={() => exportRedemptions()}>
    üì• Export Data
  </button>
  <button onClick={() => openEmailCustomers()}>
    üìß Email Customers
  </button>
</div>
```

### 3. Customer Insights

**Show top customers:**
```typescript
<div className="top-customers">
  <h3>üåü Top Customers This Month</h3>
  {topCustomers.map(customer => (
    <div key={customer.id} className="customer-row">
      <span>{customer.name}</span>
      <span>{customer.redemptionCount} redemptions</span>
      <span>${customer.totalSpent}</span>
    </div>
  ))}
</div>
```

### 4. Deal Performance

**Show which deals perform best:**
```typescript
<div className="deal-performance">
  <h3>üî• Best Performing Deals</h3>
  {topDeals.map(deal => (
    <div key={deal.id} className="deal-row">
      <span>{deal.title}</span>
      <span>{deal.redemptionCount} redemptions</span>
      <span>${deal.revenue} revenue</span>
      <span>{deal.conversionRate}% conversion</span>
    </div>
  ))}
</div>
```

---

## Part 7: Email Notifications

**Also send email when deals are redeemed:**

```typescript
// server/utils/email.ts - Add this function

export function generateRedemptionNotificationEmail(
  vendorName: string,
  dealTitle: string,
  customerName: string,
  redemptionTime: string,
  revenue: number
) {
  return `
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; }
          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
          .content { padding: 30px; background: #f9fafb; }
          .stat { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #10b981; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>üéâ Deal Redeemed!</h1>
        </div>
        
        <div class="content">
          <p>Hi ${vendorName},</p>
          
          <p>Great news! A customer just redeemed one of your deals.</p>
          
          <div class="stat">
            <strong>üé´ Deal:</strong> ${dealTitle}<br>
            <strong>üë§ Customer:</strong> ${customerName}<br>
            <strong>üïê Time:</strong> ${redemptionTime}<br>
            <strong>üí∞ Revenue:</strong> $${revenue.toFixed(2)}
          </div>
          
          <p><a href="https://riselocal.co/business/redemptions" style="display: inline-block; padding: 12px 24px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; margin-top: 20px;">View All Redemptions</a></p>
        </div>
      </body>
    </html>
  `;
}

// Send email when redemption happens
export async function sendRedemptionEmailNotification(redemption: any) {
  const vendor = await db.query('SELECT * FROM users WHERE id = $1', [redemption.vendorId]);
  
  await sendEmail({
    to: vendor.rows[0].email,
    subject: `üéâ New redemption: ${redemption.dealTitle}`,
    html: generateRedemptionNotificationEmail(
      vendor.rows[0].businessName || vendor.rows[0].firstName,
      redemption.dealTitle,
      redemption.customerName,
      new Date(redemption.redeemedAt).toLocaleString(),
      redemption.finalPrice
    )
  });
}
```

---

## Part 8: Styling (Professional Look)

```css
/* client/src/styles/redemptions.css */

.redemptions-dashboard {
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 16px;
}

.stat-icon {
  font-size: 40px;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: #1f2937;
}

.stat-label {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 4px;
}

.stat-trend {
  font-size: 12px;
  color: #10b981;
}

/* Filter Bar */
.filter-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.filter-bar select,
.filter-bar input {
  padding: 10px 16px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
}

.search-input {
  flex: 1;
  min-width: 200px;
}

/* Redemption List */
.redemption-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.redemption-card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.redemption-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.redemption-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 16px;
}

.redemption-header h3 {
  font-size: 18px;
  color: #1f2937;
  margin: 0;
}

.status-badge {
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  text-transform: capitalize;
}

.status-completed {
  background: #d1fae5;
  color: #065f46;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.status-cancelled {
  background: #fee2e2;
  color: #991b1b;
}

.redemption-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
}

.detail-row {
  display: flex;
  justify-content: space-between;
}

.detail-row .label {
  color: #6b7280;
  font-size: 14px;
}

.detail-row .value {
  color: #1f2937;
  font-weight: 500;
  font-size: 14px;
}

.detail-row .value.savings {
  color: #10b981;
}

.detail-row .value.revenue {
  color: #667eea;
}

.customer-feedback {
  margin-top: 16px;
  padding: 12px;
  background: #f9fafb;
  border-left: 3px solid #667eea;
  border-radius: 4px;
  font-style: italic;
  color: #4b5563;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: 12px;
}

.empty-icon {
  font-size: 80px;
  margin-bottom: 16px;
}

.empty-state h3 {
  font-size: 20px;
  color: #1f2937;
  margin-bottom: 8px;
}

.empty-state p {
  color: #6b7280;
  max-width: 400px;
  margin: 0 auto;
}

/* Notification Bell */
.notification-bell-container {
  position: relative;
}

.notification-bell {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  position: relative;
}

.notification-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: #ef4444;
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 18px;
}

.notification-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 8px;
  width: 360px;
  max-height: 500px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  overflow: hidden;
  z-index: 1000;
}

.notification-header {
  padding: 16px;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notification-list {
  max-height: 400px;
  overflow-y: auto;
}

.notification-item {
  padding: 16px;
  border-bottom: 1px solid #f3f4f6;
  cursor: pointer;
  display: flex;
  gap: 12px;
  align-items: start;
  transition: background 0.2s;
}

.notification-item:hover {
  background: #f9fafb;
}

.notification-item.unread {
  background: #eff6ff;
}

.notification-content strong {
  display: block;
  margin-bottom: 4px;
  color: #1f2937;
}

.notification-content p {
  margin: 0;
  font-size: 14px;
  color: #6b7280;
}

.notification-time {
  font-size: 12px;
  color: #9ca3af;
  margin-top: 4px;
  display: block;
}

.unread-dot {
  width: 8px;
  height: 8px;
  background: #3b82f6;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 6px;
}
```

---

## Summary of What You're Building

### For Vendors:
‚úÖ **Real-time redemption tracking** - See who's using deals as it happens
‚úÖ **Instant notifications** - Bell icon + email when deals are redeemed
‚úÖ **Analytics dashboard** - Revenue, trends, top customers
‚úÖ **Filtering & search** - Find specific redemptions easily
‚úÖ **Export to CSV** - Download data for accounting
‚úÖ **Customer insights** - See who your best customers are
‚úÖ **Deal performance** - Know which deals work best

### Industry Standards Implemented:
‚úÖ Stats cards (like Groupon Merchant)
‚úÖ Real-time updates (like Square Dashboard)
‚úÖ Notification system (like Toast POS)
‚úÖ Export functionality (like Stripe Dashboard)
‚úÖ Time-based filtering (like any SaaS dashboard)
‚úÖ Beautiful, professional UI (like modern dashboards)

---

## Implementation Checklist

- [ ] Fix current API error on redemptions page
- [ ] Create/verify database tables (redemptions, notifications)
- [ ] Create redemption stats endpoint
- [ ] Create notifications endpoints
- [ ] Build redemption dashboard UI
- [ ] Add notification bell component
- [ ] Implement real-time polling (every 30 seconds)
- [ ] Add email notifications for redemptions
- [ ] Style everything professionally
- [ ] Add export to CSV functionality
- [ ] Test with real data
- [ ] Add analytics charts (optional but nice)

---

**Give this entire prompt to Replit Agent and you'll get a professional, industry-standard redemption tracking system!** üöÄ